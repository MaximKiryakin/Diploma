# Моделирование управления кредитным портфелем с учетом макроэкономических условий  
**Дипломная работа**  

---

## Содержание  
1. [Введение](##введение)  
2. [Теоретическая часть](#теоретическая-часть)  
3. [Аналитическая часть](#аналитическая-часть)  
4. [Практическая часть (код на Python)](#практическая-часть)  
5. [Результаты](#результаты)  
6. [Заключение](#заключение)  
7. [Примеры кода](#примеры-кода)  
8. [Итоговые результаты](#итоговые-результаты)  

---
 
## Введение  

### Актуальность

<div style="text-align: justify;">
Современная мировая экономика сталкивается с беспрецедентными вызовами: пандемия COVID-19, геополитические конфликты, рекордная инфляция в развитых странах и энергетический кризис в Европе. Эти факторы формируют среду повышенной неопределенности, где традиционные методы управления кредитным портфелем становятся неэффективными. Резкие колебания ключевых макроэкономических показателей — ВВП, безработицы, ставок ЦБ и др. напрямую влияют на платежеспособность заемщиков, увеличивая риски дефолтов. В таких условиях разработка моделей, учитывающих не только микроэкономические, но и макроэкономические параметры, становится критически важной для прогнозирования устойчивости кредитного портфеля и минимизации убытков.
</div>


### Цель

Целью данной работы является анализ взаимосвязи основных макроэкономических показателей таких как ВВП, инфляция, ключевая ставка и др. с динамикой риска кредитного портфеля банка.


**Задачи**:  
1. Исследовать связь макропоказателей с уровнем дефолтов.  
2. Построить прогнозные модели (PD, LGD, EAD) с использованием эконометрики и ML.  
3. Провести сценарный анализ и стресс-тестирование портфеля.  
4. Оптимизировать структуру портфеля с учетом макрорисков.  

**Методы**:  
- Эконометрика: VAR/VECM, импульсные отклики (IRF).  
- Машинное обучение: XGBoost, LightGBM.  
- Оптимизация: PyPortfolioOpt.  

**Ожидаемые результаты**:  
- Снижение Expected Loss на 10-30% за счет учета макрофакторов.  

---

## Теоретическая часть  
### 2.1. Кредитный портфель: ключевые метрики  
- **PD** (Probability of Default), **LGD** (Loss Given Default), **EAD** (Exposure at Default).  
- Методы управления: диверсификация, стресс-тестирование, VaR (Value at Risk).  

### 2.2. Макроэкономические факторы риска  
- ВВП, инфляция, процентные ставки, безработица.  
- Финансовые циклы и их связь с дефолтами.  

### 2.3. Эконометрика и ML в риск-менеджменте  
- VAR-модели для анализа динамики.  
- Алгоритмы ML: градиентный бустинг, нейронные сети.  

---

## Аналитическая часть  

## Выбор российских компаний и данных для анализа кредитного портфеля

## 1. Ключевые сектора экономики РФ для анализа
**Приоритетные отрасли** (высокая чувствительность к макрошокам):
1. **Нефтегазовый** (40% бюджета РФ)
2. **Финансовый** (системообразующие банки)
3. **Металлургия** (экспортно-ориентированные)
4. **Телекоммуникации** (высокая долговая нагрузка)
5. **Розничная торговля** (чувствительность к инфляции)

## 2. Рекомендуемые компании
| Сектор          | Компании (тикеры)                          | Критерий отбора                     |
|-----------------|--------------------------------------------|--------------------------------------|
| Нефтегазовый    | Газпром (GAZP), Лукойл (LKOH), Роснефть (ROSN) | Доля в ВВП >5%, валютная выручка     |
| Финансы         | Сбербанк (SBER), ВТБ (VTBR), Тинькофф (TCSG)   | Системная значимость (СППБ)          |
| Металлургия     | Норникель (GMKN), НЛМК (NLMK), Русал (RUAL)    | Экспорт >70% выручки                 |
| Телеком         | МТС (MTSS), Ростелеком (RTKM), МегаФон         | Debt/EBITDA >3x                      |
| Розница         | Магнит (MGNT), X5 Retail (FIVE), Лента (LNTA)  | Зависимость от потребительского спроса |

## 3. Необходимые данные

### 3.1. Макроэкономические показатели (источники: ЦБ РФ, Росстат, Минэкономразвития):
- **Цены на нефть Urals** (месячные данные)
- **Курс USD/RUB, EUR/RUB** (волатильность)
- **Ключевая ставка ЦБ** 
- **Инфляция (ИПЦ)** 
- **Индекс промпроизводства**
- **Санкционные события** (даты введения/ужесточения)

### 3.2. Финансовые данные компаний:
| Показатель                | Источник                          | Периодичность |
|---------------------------|-----------------------------------|---------------|
| МСФО-отчетность           | Официальные сайты эмитентов, СКРИН | Квартальная   |
| Кредитные рейтинги        | ACRA, Эксперт РА, НКР            | Ежеквартально |
| Рыночные данные (биржи)   | Московская биржа, Bloomberg      | Ежедневная    |
| Кредитная история         | Национальное бюро кредитных историй | Ежемесячная  |

### 3.3. Ключевые мультипликаторы для анализа:
1. **Долговая нагрузка**: 
   - Debt/EBITDA (пороговое значение >4x для риска)
   - Interest Coverage Ratio (<2x – тревожный сигнал)

2. **Ловушки ликвидности**:
   - Quick Ratio (<0.8 – риск кассовых разрывов)
   - Доля краткосрочных займов (>40% – угроза рефинансирования)

3. **Валютные риски**:
   - Доля валютных обязательств (>30% выручки в рублях – риск)
   - Хеджирование (% покрытых позиций)

## 4. Особенности сбора данных для РФ
1. **Проблемы**:
   - Неполная раскрываемость данных по госкомпаниям
   - Искажения в отчетности из-за санкционных ограничений
   - Высокая волатильность (требуются daily данные)

2. **Решения**:
   - Использовать агрегированные отраслевые индексы (Мосбиржа)
   - Применять веб-скрейпинг для сбора данных с сайтов ЦБ и Минфина
   - Ввести dummy-переменные для санкционных периодов

## 5. Пример структуры датасета
```python
import pandas as pd

data_template = {
    'Date': '2023-12-31',
    'Company': 'SBER',
    'Sector': 'Financials',
    'PD': 0.023,  # Вероятность дефолта
    'Debt/EBITDA': 3.2,
    'FX_Exposure': 0.15,  # Доля валютных обязательств
    'Oil_Price': 75.4,    # Brent, $/барр
    'USD_RUB': 92.1,
    'KeyRate': 7.5,       # Ключевая ставка
    'Sanctions_Index': 0.8 # 0-1 (интенсивность санкций)
}

df = pd.DataFrame([data_template])
```

### 3.1. Сбор и подготовка данных  
- Источники:  
  - Макропоказатели: ЦБ, Bloomberg, FRED.  
  - Кредитные данные: история дефолтов, LGD/EAD.  

### 3.2. Исследование взаимосвязей

- Корреляционный анализ:




### 3.2.1. Выбор компаний для анализа на основе мультипликаторов  
Для анализа кредитного портфеля важно выбрать компании, которые будут включены в исследование. Это можно сделать на основе финансовых мультипликаторов, которые отражают устойчивость компании к макроэкономическим шокам.  

### 3.2.2. Разделение компаний по секторам для диверсификации портфеля  
Для снижения системных рисков и повышения устойчивости кредитного портфеля предлагается **секторальная диверсификация**, учитывающая различную чувствительность отраслей к макроэкономическим шокам.  

#### Методология:  
1. **Классификация компаний по секторам** (GICS):  
   - Энергетика, IT, Финансы, Потребительские товары и др.  
   - Пример: Нефтегазовый сектор более уязвим к колебаниям цен на сырье, тогда как IT зависит от курса валют и регуляторных изменений.  

2. **Расчет корреляции между секторами**:
   
   - Использование исторических данных о дефолтах для определения взаимосвязей.  

#### Ключевые мультипликаторы  
1. **P/E (Price-to-Earnings)**: Отношение цены акции к прибыли на акцию. Низкий P/E может указывать на недооцененность компании.  
2. **Debt/EBITDA**: Отношение долга к EBITDA. Показывает способность компании обслуживать долг.  
3. **Current Ratio**: Коэффициент текущей ликвидности. Отражает способность компании покрывать краткосрочные обязательства.  
4. **Interest Coverage Ratio**: Покрытие процентов по долгу. Показывает, насколько прибыль компании покрывает процентные платежи.  

#### Алгоритм выбора компаний  
1. Рассчитать мультипликаторы для всех компаний в выборке.  
2. Отфильтровать компании по пороговым значениям:  
   - Debt/EBITDA < 3 (низкий уровень долговой нагрузки).  
   - Current Ratio > 1.5 (высокая ликвидность).  
   - Interest Coverage Ratio > 2 (достаточное покрытие процентов).  
3. Ранжировать компании по P/E и выбрать топ-20 с наименьшим значением.  

### 3.3. Анализ импульсных откликов (IRF)

- Построение VAR-модели:

- Визуализация IRF:

## Практическая часть
### 4.1. Прогнозирование PD

- Логистическая регрессия:

- Градиентный бустинг (XGBoost):

### 4.2. Оценка LGD и EAD

- Регрессия LGD:
- Моделирование EAD:

### 4.3. Оптимизация портфеля

- Минимизация Expected Loss:

### 4.4. Сценарный анализ

- Симуляция шока инфляции:

- Результаты

### 5.1. Сравнение моделей
- Модель	AUC-ROC
- Логистическая регрессия	0.78
- XGBoost	0.87
### 5.2. Оптимальная структура портфеля

### 5.3. Анализ чувствительности

**Выводы:**

- Учет макрофакторов повышает точность прогноза дефолтов на 15-20%.

- Оптимизация снижает Expected Loss на 25% в сценарии рецессии.

**Рекомендации:**

- Использовать IRF-анализ для стресс-тестирования.

- Динамически корректировать портфель при изменении макроусловий.

