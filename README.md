# Моделирование управления кредитным портфелем с учетом макроэкономических условий  
**Дипломная работа**  

---

## Содержание  
1. [Введение](##введение)  
2. [Теоретическая часть](#теоретическая-часть)  
3. [Аналитическая часть](#аналитическая-часть)  
4. [Практическая часть (код на Python)](#практическая-часть)  
5. [Результаты](#результаты)  
6. [Заключение](#заключение)  
7. [Примеры кода](#примеры-кода)  
8. [Итоговые результаты](#итоговые-результаты)  

---

## Введение  

### Актуальность

<div style="text-align: justify;">
Современная мировая экономика сталкивается с беспрецедентными вызовами: пандемия COVID-19, геополитические конфликты, рекордная инфляция в развитых странах и энергетический кризис в Европе. Эти факторы формируют среду повышенной неопределенности, где традиционные методы управления кредитным портфелем становятся неэффективными. Резкие колебания ключевых макроэкономических показателей — ВВП, безработицы, ставок ЦБ и др. напрямую влияют на платежеспособность заемщиков, увеличивая риски дефолтов. В таких условиях разработка моделей, учитывающих не только микроэкономические, но и макроэкономические параметры, становится критически важной для прогнозирования устойчивости кредитного портфеля и минимизации убытков.
</div>


### Цель

Целью данной работы является анализ взаимосвязи основных макроэкономических показателей таких как ВВП, инфляция, ключевая ставка и др. с динамикой риска кредитного портфеля банка.


**Задачи**:  
1. Исследовать связь макропоказателей с уровнем дефолтов.  
2. Построить прогнозные модели (PD, LGD, EAD) с использованием эконометрики и ML.  
3. Провести сценарный анализ и стресс-тестирование портфеля.  
4. Оптимизировать структуру портфеля с учетом макрорисков.  

**Методы**:  
- Эконометрика: VAR/VECM, импульсные отклики (IRF).  
- Машинное обучение: XGBoost, LightGBM.  
- Оптимизация: PyPortfolioOpt.  

**Ожидаемые результаты**:  
- Снижение Expected Loss на 10-30% за счет учета макрофакторов.  

---

## Теоретическая часть  
### 2.1. Кредитный портфель: ключевые метрики  
- **PD** (Probability of Default), **LGD** (Loss Given Default), **EAD** (Exposure at Default).  
- Методы управления: диверсификация, стресс-тестирование, VaR (Value at Risk).  

### 2.2. Макроэкономические факторы риска  
- ВВП, инфляция, процентные ставки, безработица.  
- Финансовые циклы и их связь с дефолтами.  

### 2.3. Эконометрика и ML в риск-менеджменте  
- VAR-модели для анализа динамики.  
- Алгоритмы ML: градиентный бустинг, нейронные сети.  

---

## Аналитическая часть  
### 3.1. Сбор и подготовка данных  
- Источники:  
  - Макропоказатели: ЦБ, Bloomberg, FRED.  
  - Кредитные данные: история дефолтов, LGD/EAD.  

### 3.2. Исследование взаимосвязей

- Корреляционный анализ:




### 3.2.1. Выбор компаний для анализа на основе мультипликаторов  
Для анализа кредитного портфеля важно выбрать компании, которые будут включены в исследование. Это можно сделать на основе финансовых мультипликаторов, которые отражают устойчивость компании к макроэкономическим шокам.  

### 3.2.2. Разделение компаний по секторам для диверсификации портфеля  
Для снижения системных рисков и повышения устойчивости кредитного портфеля предлагается **секторальная диверсификация**, учитывающая различную чувствительность отраслей к макроэкономическим шокам.  

#### Методология:  
1. **Классификация компаний по секторам** (GICS):  
   - Энергетика, IT, Финансы, Потребительские товары и др.  
   - Пример: Нефтегазовый сектор более уязвим к колебаниям цен на сырье, тогда как IT зависит от курса валют и регуляторных изменений.  

2. **Расчет корреляции между секторами**:
   
   - Использование исторических данных о дефолтах для определения взаимосвязей.  

#### Ключевые мультипликаторы  
1. **P/E (Price-to-Earnings)**: Отношение цены акции к прибыли на акцию. Низкий P/E может указывать на недооцененность компании.  
2. **Debt/EBITDA**: Отношение долга к EBITDA. Показывает способность компании обслуживать долг.  
3. **Current Ratio**: Коэффициент текущей ликвидности. Отражает способность компании покрывать краткосрочные обязательства.  
4. **Interest Coverage Ratio**: Покрытие процентов по долгу. Показывает, насколько прибыль компании покрывает процентные платежи.  

#### Алгоритм выбора компаний  
1. Рассчитать мультипликаторы для всех компаний в выборке.  
2. Отфильтровать компании по пороговым значениям:  
   - Debt/EBITDA < 3 (низкий уровень долговой нагрузки).  
   - Current Ratio > 1.5 (высокая ликвидность).  
   - Interest Coverage Ratio > 2 (достаточное покрытие процентов).  
3. Ранжировать компании по P/E и выбрать топ-20 с наименьшим значением.  

### 3.3. Анализ импульсных откликов (IRF)

- Построение VAR-модели:

- Визуализация IRF:

## Практическая часть
### 4.1. Прогнозирование PD

- Логистическая регрессия:

- Градиентный бустинг (XGBoost):

### 4.2. Оценка LGD и EAD

- Регрессия LGD:
- Моделирование EAD:

### 4.3. Оптимизация портфеля

- Минимизация Expected Loss:

### 4.4. Сценарный анализ

- Симуляция шока инфляции:

- Результаты

### 5.1. Сравнение моделей
- Модель	AUC-ROC
- Логистическая регрессия	0.78
- XGBoost	0.87
### 5.2. Оптимальная структура портфеля

### 5.3. Анализ чувствительности

**Выводы:**

- Учет макрофакторов повышает точность прогноза дефолтов на 15-20%.

- Оптимизация снижает Expected Loss на 25% в сценарии рецессии.

**Рекомендации:**

- Использовать IRF-анализ для стресс-тестирования.

- Динамически корректировать портфель при изменении макроусловий.

