# Моделирование управления кредитным портфелем с учетом макроэкономических условий

**Магистерская диссертация**

Факультет вычислительной математики и кибернетики МГУ им. М.В. Ломоносова.
**Автор:** Кирякин Максим Валерьевич

---

## Актуальность

<div style="text-align: justify;">
Современная экономика характеризуется высокой волатильностью и неопределенностью. Традиционные кредитные модели часто не учитывают динамическое влияние макроэкономических шоков на вероятность дефолта. В данной работе исследуется адаптация модели Мертона к российскому рынку с интеграцией макроэкономических факторов (инфляция, ключевая ставка, курс валют) для более точного прогнозирования и управления рисками кредитного портфеля.
</div>

---

## О проекте
Исследование направлено на разработку комплексного инструментария для анализа и прогнозирования кредитных рисков:
- **Оценка риска**: Реализация структурной модели Мертона для оценки Credit PD на основе рыночных данных.
- **Макро-прогнозирование**: Интеграция моделей временных рядов (**VAR**, **SARIMAX**, **Facebook Prophet**) для прогнозирования макросреды.
- **Сценарный анализ**: Оценка влияния макроэкономических шоков через функции импульсного отклика (IRF).
- **Визуализация**: Интерактивные дашборды по тикерам, корреляционные матрицы и прогнозы PD.

---

## Структура проекта
- `main.ipynb` — Основной ноутбук с полным циклом расчетов.
- `utils/` — Модули с логикой:
    - `portfolio.py` — Ядро системы (класс `Portfolio`).
    - `setup.py` — Настройка окружения и логирования.
    - `plots.py` — Библиотека визуализации.
    - `load_data.py` — Загрузка данных из внешних источников (MOEX, CBR, Yahoo Finance).
    - `logger.py` — Кастомный логгер для отслеживания процесса расчетов.
    - `LabelsDict.py` — Словари и маппинги для графиков.
- `data/` — Локальное хранилище данных и бэкапов.
- `logs/` — Результаты анализа и сохраненные графики.
- `.github/` — Инструкции и конфигурации для совместной разработки.

---

## Разработка

В проекте используются инструменты для обеспечения качества кода:
- **Black**: Автоматическое форматирование кода (длина строки 120 символов).
- **Flake8**: Линтер для проверки соответствия PEP 8.
- **Pre-commit**: Git-хуки для автоматической проверки кода перед коммитом.

Для настройки окружения разработки:
```bash
pip install -r requirements.txt
pre-commit install
```

---

## Установка и запуск
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. (Опционально) Настройте git-хуки для разработки:
   ```bash
   pre-commit install
   ```
3. Откройте `main.ipynb` и запустите ячейки. Система автоматически настроит окружение через `setup_enviroment()`.

---

## Пример использования (API)
```python
from utils.setup import setup_enviroment
from utils.portfolio import Portfolio

# 1. Инициализация и настройка
setup_enviroment()
calc = Portfolio(dt_calc='2025-09-30', dt_start='2019-03-31', tickers_list=tickers)

# 2. Загрузка данных (рыночные + макро)
calc.load_stock_data().load_multipliers().load_macro_data()

# 3. Расчет PD по модели Мертона
calc.create_portfolio().add_dynamic_features().add_merton_pd()

# 4. Прогнозирование и визуализация
calc.plot_macro_forecast(horizon=-6, models=['var', 'sarimax', 'prophet'])
calc.plot_ticker_dashboards(tickers=['GAZP', 'SBER'])
```
